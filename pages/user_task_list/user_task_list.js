"use strict";
var apiUserTask = require('../../utils/request/api');
var CONFIRM_USER_TASK = 1;
var CANCEL_USR_TASK = 2;
Page({
    data: {
        addflag: true,
        addimg: '../../images/activity_add.png',
        searchstr: '',
        listData: new Array(),
        hiddenModalPut: true,
        activeTask: {
            id: 0,
            name: '',
            detail: '',
            process: {},
            showMore: false
        },
        updateDetail: '',
        existDetails: new Array(),
        buttons: [{ text: '取消', index: CANCEL_USR_TASK }, { text: '确定', index: CONFIRM_USER_TASK }],
        radioItems: [
            { name: '未完成', value: 'UNDONE' },
            { name: '完成', value: 'COMPLETED', checked: true },
        ],
    },
    onLoad: function () {
        this.loadData();
    },
    onShow: function () {
    },
    tap: function (e) {
        console.log(e);
    },
    addhandle: function () {
        console.log('触发搜索框右侧事件');
    },
    searchList: function (ev) {
        var e = ev.detail;
        this.setData({
            searchstr: e.detail.value
        });
    },
    endsearchList: function (e) {
        console.log('查询数据', e);
    },
    cancelsearch: function () {
        this.setData({
            searchstr: ''
        });
    },
    activity_clear: function (e) {
        console.log(e);
        this.setData({
            searchstr: ''
        });
    },
    loadData: function () {
        var _this = this;
        apiUserTask.userTaskList().then(function (res) {
            var _a;
            console.log(res);
            var list = new Array();
            for (var index = 0; index < res.data.length; index++) {
                var element = res.data[index];
                list.push({
                    id: element.id,
                    name: element.name,
                    detail: element.detail,
                    process: {
                        id: element.process.id,
                        detail: element.process.detail,
                        completed: false,
                        details: (_a = element.process.details) !== null && _a !== void 0 ? _a : [],
                    },
                    showMore: false
                });
            }
            console.log('赋值完成的 list 为:', list);
            _this.setData({
                listData: list
            });
        });
    },
    tapTaskItem: function (e) {
        console.log('点击了任务卡片,事件为:', e);
        var listData = this.data.listData;
        for (var index = 0; index < listData.length; index++) {
            var element = listData[index];
            if (e.currentTarget.dataset.itemId == element.id) {
                listData[index].showMore = !element.showMore;
            }
        }
        this.setData({
            listData: listData,
        });
    },
    onRightBtnTap: function (e) {
        console.log('点击右边的按钮事件并且被 catch', e);
        this.setData({
            activeTask: e.currentTarget.dataset.item,
            hiddenModalPut: !this.data.hiddenModalPut,
            existDetails: e.currentTarget.dataset.item.process.details
        });
    },
    cancel: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    confirm: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    textInput: function (e) {
        console.log('当前文本输入的事件为:', e);
        this.setData({
            updateDetail: e.detail.value
        });
    },
    tapDialogButton: function (e) {
        var _this = this;
        console.log('传入的事件为:', e);
        if (e.detail.item.index == CONFIRM_USER_TASK) {
            console.log('当前页面数据为:', this.data.activeTask);
            console.log('当前的 detail 数据为:', this.data.updateDetail);
            apiUserTask.updateProcess({
                process_id: this.data.activeTask.process.id,
                detail: this.data.updateDetail,
                completed: 1,
            }).then(function (res) {
                console.log('更新用户任务细节返回结果为::', res);
                _this.setData({
                    hiddenModalPut: true
                });
                _this.loadData();
            }).catch(function (err) {
                console.log('更新用户任务细节失败,结果为:', err);
                _this.setData({
                    hiddenModalPut: true
                });
            });
        }
        else if (e.detail.item.index == CANCEL_USR_TASK) {
            this.setData({
                hiddenModalPut: true
            });
        }
    },
    radioChange: function (e) {
        console.log('点击了切换按钮');
        var items = this.data.radioItems;
        for (var i = 0; i < items.length; ++i) {
            items[i].checked = items[i].value == e.detail.value;
        }
        console.log(items);
        this.setData({
            radioItems: items
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcl90YXNrX2xpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2VyX3Rhc2tfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsSUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLHlCQUF5QixDQUFDLENBQUE7QUFzQnRELElBQU0saUJBQWlCLEdBQUcsQ0FBQyxDQUFBO0FBQzNCLElBQU0sZUFBZSxHQUFHLENBQUMsQ0FBQTtBQUV6QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixPQUFPLEVBQUUsSUFBSTtRQUNiLE1BQU0sRUFBRSwrQkFBK0I7UUFDdkMsU0FBUyxFQUFFLEVBQUU7UUFDYixRQUFRLEVBQUUsSUFBSSxLQUFLLEVBQWdCO1FBR25DLGNBQWMsRUFBRSxJQUFJO1FBQ3BCLFVBQVUsRUFBZ0I7WUFDeEIsRUFBRSxFQUFFLENBQUM7WUFDTCxJQUFJLEVBQUUsRUFBRTtZQUNSLE1BQU0sRUFBRSxFQUFFO1lBQ1YsT0FBTyxFQUFFLEVBQUU7WUFDWCxRQUFRLEVBQUUsS0FBSztTQUNoQjtRQUNELFlBQVksRUFBRSxFQUFFO1FBQ2hCLFlBQVksRUFBRSxJQUFJLEtBQUssRUFBVTtRQUNqQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztRQUMzRixVQUFVLEVBQUU7WUFDVixFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtZQUNoQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFO1NBQ2xEO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBQ2pCLENBQUM7SUFDRCxNQUFNO0lBRU4sQ0FBQztJQUVELEdBQUcsRUFB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RyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3JDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQTtTQUNwRDtRQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFbEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLFVBQVUsRUFBRSxLQUFLO1NBQ2xCLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FHRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy91c2VyX3Rhc2tfbGlzdC91c2VyX3Rhc2tfbGlzdC50c1xuY29uc3QgYXBpVXNlclRhc2sgPSByZXF1aXJlKCcuLi8uLi91dGlscy9yZXF1ZXN0L2FwaScpXG5cbmludGVyZmFjZSBVc2VyVGFza0l0ZW0ge1xuICBpZDogbnVtYmVyXG4gIG5hbWU6IHN0cmluZ1xuICBkZXRhaWw6IHN0cmluZ1xuICBwcm9jZXNzOiBQcm9jZXNzXG4gIHNob3dNb3JlOiBib29sZWFuXG59XG5cbmludGVyZmFjZSBQcm9jZXNzIHtcbiAgaWQ6IG51bWJlclxuICBjb21wbGV0ZWQ6IGJvb2xlYW5cbiAgZGV0YWlsOiBzdHJpbmdcbiAgZGV0YWlsczogQXJyYXk8RGV0YWlsPlxufVxuXG5pbnRlcmZhY2UgRGV0YWlsIHtcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICB0aW1lOiBzdHJpbmdcbn1cblxuY29uc3QgQ09ORklSTV9VU0VSX1RBU0sgPSAxXG5jb25zdCBDQU5DRUxfVVNSX1RBU0sgPSAyXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgYWRkZmxhZzogdHJ1ZSwgIC8v5Yik5pat5piv5ZCm5pi+56S65pCc57Si5qGG5Y+z5L6n6YOo5YiGXG4gICAgYWRkaW1nOiAnLi4vLi4vaW1hZ2VzL2FjdGl2aXR5X2FkZC5wbmcnLFxuICAgIHNlYXJjaHN0cjogJycsXG4gICAgbGlzdERhdGE6IG5ldyBBcnJheTxVc2VyVGFza0l0ZW0+KCksXG5cbiAgICAvL+WPr+S7pemAmui/h2hpZGRlbuaYr+WQpuaOqeiXj+W8ueWHuuahhueahOWxnuaAp++8jOadpeaMh+WumumCo+S4quW8ueWHuuahhlxuICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlLFxuICAgIGFjdGl2ZVRhc2s6IDxVc2VyVGFza0l0ZW0+e1xuICAgICAgaWQ6IDAsXG4gICAgICBuYW1lOiAnJyxcbiAgICAgIGRldGFpbDogJycsXG4gICAgICBwcm9jZXNzOiB7fSxcbiAgICAgIHNob3dNb3JlOiBmYWxzZVxuICAgIH0sXG4gICAgdXBkYXRlRGV0YWlsOiAnJyxcbiAgICBleGlzdERldGFpbHM6IG5ldyBBcnJheTxEZXRhaWw+KCksXG4gICAgYnV0dG9uczogW3sgdGV4dDogJ+WPlua2iCcsIGluZGV4OiBDQU5DRUxfVVNSX1RBU0sgfSwgeyB0ZXh0OiAn56Gu5a6aJywgaW5kZXg6IENPTkZJUk1fVVNFUl9UQVNLIH1dLFxuICAgIHJhZGlvSXRlbXM6IFtcbiAgICAgIHsgbmFtZTogJ+acquWujOaIkCcsIHZhbHVlOiAnVU5ET05FJyB9LFxuICAgICAgeyBuYW1lOiAn5a6M5oiQJywgdmFsdWU6ICdDT01QTEVURUQnLCBjaGVja2VkOiB0cnVlIH0sXG4gICAgXSxcbiAgfSxcblxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5sb2FkRGF0YSgpXG4gIH0sXG4gIG9uU2hvdygpIHtcblxuICB9LFxuXG4gIHRhcChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlKVxuICB9LFxuXG4gIC8vIOaQnOe0ouahhuWPs+S+pyDkuovku7ZcbiAgYWRkaGFuZGxlKCkge1xuICAgIGNvbnNvbGUubG9nKCfop6blj5HmkJzntKLmoYblj7Pkvqfkuovku7YnKVxuICB9LFxuXG4gIC8v5pCc57Si5qGG6L6T5YWl5pe26Kem5Y+RXG4gIHNlYXJjaExpc3QoZXY6IGFueSkge1xuICAgIGxldCBlID0gZXYuZGV0YWlsO1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzZWFyY2hzdHI6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgLy/mkJzntKLlm57osINcbiAgZW5kc2VhcmNoTGlzdChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygn5p+l6K+i5pWw5o2uJywgZSlcbiAgfSxcbiAgLy8g5Y+W5raI5pCc57SiXG4gIGNhbmNlbHNlYXJjaCgpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgc2VhcmNoc3RyOiAnJ1xuICAgIH0pXG4gIH0sXG4gIC8v5riF56m65pCc57Si5qGGXG4gIGFjdGl2aXR5X2NsZWFyKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG5cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgc2VhcmNoc3RyOiAnJ1xuICAgIH0pXG4gIH0sXG5cbiAgbG9hZERhdGEoKSB7XG4gICAgYXBpVXNlclRhc2sudXNlclRhc2tMaXN0KCkudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIGxldCBsaXN0OiBBcnJheTxVc2VyVGFza0l0ZW0+ID0gbmV3IEFycmF5KClcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCByZXMuZGF0YS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHJlcy5kYXRhW2luZGV4XTtcbiAgICAgICAgbGlzdC5wdXNoKHtcbiAgICAgICAgICBpZDogZWxlbWVudC5pZCxcbiAgICAgICAgICBuYW1lOiBlbGVtZW50Lm5hbWUsXG4gICAgICAgICAgZGV0YWlsOiBlbGVtZW50LmRldGFpbCxcbiAgICAgICAgICBwcm9jZXNzOiB7XG4gICAgICAgICAgICBpZDogZWxlbWVudC5wcm9jZXNzLmlkLFxuICAgICAgICAgICAgZGV0YWlsOiBlbGVtZW50LnByb2Nlc3MuZGV0YWlsLFxuICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRldGFpbHM6IGVsZW1lbnQucHJvY2Vzcy5kZXRhaWxzID8/IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2hvd01vcmU6IGZhbHNlXG4gICAgICAgIH0pXG5cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCfotYvlgLzlrozmiJDnmoQgbGlzdCDkuLo6JywgbGlzdClcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGxpc3REYXRhOiBsaXN0XG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG5cbiAgdGFwVGFza0l0ZW0oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+S6huS7u+WKoeWNoeeJhyzkuovku7bkuLo6JywgZSlcbiAgICBsZXQgbGlzdERhdGEgPSB0aGlzLmRhdGEubGlzdERhdGFcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGlzdERhdGEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gbGlzdERhdGFbaW5kZXhdO1xuICAgICAgaWYgKGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW1JZCA9PSBlbGVtZW50LmlkKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCfmjInntKLlvJXlj5blh7rnmoTmlbDmja7kuLo6JywgbGlzdERhdGFbaW5kZXhdKVxuICAgICAgICAvLyBjb25zb2xlLmxvZygn5LmL5YmN5oyJ57Si5byV5Y+W5Ye655qE5Li6OicsIGxpc3REYXRhW2luZGV4XSlcbiAgICAgICAgbGlzdERhdGFbaW5kZXhdLnNob3dNb3JlID0gIWVsZW1lbnQuc2hvd01vcmVcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGxpc3REYXRhOiBsaXN0RGF0YSxcbiAgICB9KVxuICB9LFxuXG4gIG9uUmlnaHRCdG5UYXAoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+WPs+i+ueeahOaMiemSruS6i+S7tuW5tuS4lOiiqyBjYXRjaCcsIGUpXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGFjdGl2ZVRhc2s6IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW0sXG4gICAgICBoaWRkZW5Nb2RhbFB1dDogIXRoaXMuZGF0YS5oaWRkZW5Nb2RhbFB1dCxcbiAgICAgIGV4aXN0RGV0YWlsczogZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbS5wcm9jZXNzLmRldGFpbHNcbiAgICB9KVxuICB9LFxuXG4gIC8v54K55Ye75oyJ6ZKu5by55Ye65oyH5a6a55qEaGlkZGVuTW9kYWxQdXTlvLnlh7rmoYZcbiAgLy/lvLnlh7rmoYbnmoTooajljZVcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy/lj5bmtojmjInpkq5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pO1xuICB9LFxuICAvL+ehruiupFxuICBjb25maXJtKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pXG4gIH0sXG5cbiAgdGV4dElucHV0KGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCflvZPliY3mlofmnKzovpPlhaXnmoTkuovku7bkuLo6JywgZSlcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdXBkYXRlRGV0YWlsOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG5cbiAgLy/lr7nor53moYbngrnlh7vnoa7lrprlkozlj5bmtojlnYfov5vlhaXmraTlpIQg5qC55o2uIGluZGV4IOi/m+ihjOWIpOaWrVxuICB0YXBEaWFsb2dCdXR0b24oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+S8oOWFpeeahOS6i+S7tuS4ujonLCBlKVxuICAgIC8v5aaC5p6c54K55Ye755qE5piv56Gu6K6k5oyJ6ZKuXG4gICAgaWYgKGUuZGV0YWlsLml0ZW0uaW5kZXggPT0gQ09ORklSTV9VU0VSX1RBU0spIHtcbiAgICAgIGNvbnNvbGUubG9nKCflvZPliY3pobXpnaLmlbDmja7kuLo6JywgdGhpcy5kYXRhLmFjdGl2ZVRhc2spXG4gICAgICBjb25zb2xlLmxvZygn5b2T5YmN55qEIGRldGFpbCDmlbDmja7kuLo6JywgdGhpcy5kYXRhLnVwZGF0ZURldGFpbClcbiAgICAgIGFwaVVzZXJUYXNrLnVwZGF0ZVByb2Nlc3Moe1xuICAgICAgICBwcm9jZXNzX2lkOiB0aGlzLmRhdGEuYWN0aXZlVGFzay5wcm9jZXNzLmlkLFxuICAgICAgICBkZXRhaWw6IHRoaXMuZGF0YS51cGRhdGVEZXRhaWwsXG4gICAgICAgIGNvbXBsZXRlZDogMSxcbiAgICAgIH0pLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfmm7TmlrDnlKjmiLfku7vliqHnu4boioLov5Tlm57nu5PmnpzkuLo6OicsIHJlcylcbiAgICAgICAgLy/mm7TmlrDlrozmiJDkuYvlkI7ph43mlrDmi4nlj5bmlbDmja5cbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmxvYWREYXRhKClcbiAgICAgIH0pLmNhdGNoKChlcnI6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygn5pu05paw55So5oi35Lu75Yqh57uG6IqC5aSx6LSlLOe7k+aenOS4ujonLCBlcnIpXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgaGlkZGVuTW9kYWxQdXQ6IHRydWVcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmIChlLmRldGFpbC5pdGVtLmluZGV4ID09IENBTkNFTF9VU1JfVEFTSykge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgaGlkZGVuTW9kYWxQdXQ6IHRydWVcbiAgICAgIH0pXG4gICAgfVxuXG4gIH0sXG5cbiAgcmFkaW9DaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+S6huWIh+aNouaMiemSricpXG4gICAgdmFyIGl0ZW1zID0gdGhpcy5kYXRhLnJhZGlvSXRlbXNcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgKytpKSB7XG4gICAgICBpdGVtc1tpXS5jaGVja2VkID0gaXRlbXNbaV0udmFsdWUgPT0gZS5kZXRhaWwudmFsdWVcbiAgICB9XG4gICAgY29uc29sZS5sb2coaXRlbXMpXG5cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcmFkaW9JdGVtczogaXRlbXNcbiAgICB9KTtcbiAgfSxcblxuXG59KSJdfQ==