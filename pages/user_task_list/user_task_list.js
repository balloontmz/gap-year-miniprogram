"use strict";
var api = require('../../utils/request/api');
var CONFIRM_USER_TASK = 1;
var CANCEL_USR_TASK = 2;
Page({
    data: {
        addflag: true,
        addimg: '../../images/activity_add.png',
        searchstr: '',
        listData: new Array(),
        hiddenModalPut: true,
        activeTask: {
            id: 0,
            name: '',
            detail: '',
            process: {},
            showMore: false
        },
        updateDetail: '',
        existDetails: new Array(),
        buttons: [{ text: '取消', index: CANCEL_USR_TASK }, { text: '确定', index: CONFIRM_USER_TASK }],
        radioItems: [
            { name: '未完成', value: 'UNDONE' },
            { name: '完成', value: 'COMPLETED', checked: true },
        ],
    },
    onLoad: function () {
        this.loadData();
    },
    onShow: function () {
    },
    tap: function (e) {
        console.log(e);
    },
    addhandle: function () {
        console.log('触发搜索框右侧事件');
    },
    searchList: function (ev) {
        var e = ev.detail;
        this.setData({
            searchstr: e.detail.value
        });
    },
    endsearchList: function (e) {
        console.log('查询数据', e);
    },
    cancelsearch: function () {
        this.setData({
            searchstr: ''
        });
    },
    activity_clear: function (e) {
        console.log(e);
        this.setData({
            searchstr: ''
        });
    },
    loadData: function () {
        var _this = this;
        api.userTaskList().then(function (res) {
            var _a;
            console.log(res);
            var list = new Array();
            for (var index = 0; index < res.data.length; index++) {
                var element = res.data[index];
                list.push({
                    id: element.id,
                    name: element.name,
                    detail: element.detail,
                    process: {
                        id: element.process.id,
                        detail: element.process.detail,
                        completed: false,
                        details: (_a = element.process.details) !== null && _a !== void 0 ? _a : [],
                    },
                    showMore: false
                });
            }
            console.log('赋值完成的 list 为:', list);
            _this.setData({
                listData: list
            });
        });
    },
    tapTaskItem: function (e) {
        console.log('点击了任务卡片,事件为:', e);
        var listData = this.data.listData;
        for (var index = 0; index < listData.length; index++) {
            var element = listData[index];
            if (e.currentTarget.dataset.itemId == element.id) {
                listData[index].showMore = !element.showMore;
            }
        }
        this.setData({
            listData: listData,
        });
    },
    onRightBtnTap: function (e) {
        console.log('点击右边的按钮事件并且被 catch', e);
        this.setData({
            activeTask: e.currentTarget.dataset.item,
            hiddenModalPut: !this.data.hiddenModalPut,
            existDetails: e.currentTarget.dataset.item.process.details
        });
    },
    cancel: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    confirm: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    textInput: function (e) {
        console.log('当前文本输入的事件为:', e);
        this.setData({
            updateDetail: e.detail.value
        });
    },
    tapDialogButton: function (e) {
        var _this = this;
        console.log('传入的事件为:', e);
        if (e.detail.item.index == CONFIRM_USER_TASK) {
            console.log('当前页面数据为:', this.data.activeTask);
            console.log('当前的 detail 数据为:', this.data.updateDetail);
            api.updateProcess({
                process_id: this.data.activeTask.process.id,
                detail: this.data.updateDetail,
                completed: 1,
            }).then(function (res) {
                console.log('更新用户任务细节返回结果为::', res);
                _this.setData({
                    hiddenModalPut: true
                });
                _this.loadData();
            }).catch(function (err) {
                console.log('更新用户任务细节失败,结果为:', err);
                _this.setData({
                    hiddenModalPut: true
                });
            });
        }
        else if (e.detail.item.index == CANCEL_USR_TASK) {
            this.setData({
                hiddenModalPut: true
            });
        }
    },
    radioChange: function (e) {
        console.log('点击了切换按钮');
        var items = this.data.radioItems;
        for (var i = 0; i < items.length; ++i) {
            items[i].checked = items[i].value == e.detail.value;
        }
        console.log(items);
        this.setData({
            radioItems: items
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcl90YXNrX2xpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2VyX3Rhc2tfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLHlCQUF5QixDQUFDLENBQUE7QUFzQjVDLElBQU0saUJBQWlCLEdBQUcsQ0FBQyxDQUFBO0FBQzNCLElBQU0sZUFBZSxHQUFHLENBQUMsQ0FBQTtBQUV6QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixPQUFPLEVBQUUsSUFBSTtRQUNiLE1BQU0sRUFBRSwrQkFBK0I7UUFDdkMsU0FBUyxFQUFFLEVBQUU7UUFDYixRQUFRLEVBQUUsSUFBSSxLQUFLLEVBQWdCO1FBR25DLGNBQWMsRUFBRSxJQUFJO1FBQ3BCLFVBQVUsRUFBZ0I7WUFDeEIsRUFBRSxFQUFFLENBQUM7WUFDTCxJQUFJLEVBQUUsRUFBRTtZQUNSLE1BQU0sRUFBRSxFQUFFO1lBQ1YsT0FBTyxFQUFFLEVBQUU7WUFDWCxRQUFRLEVBQUUsS0FBSztTQUNoQjtRQUNELFlBQVksRUFBRSxFQUFFO1FBQ2hCLFlBQVksRUFBRSxJQUFJLEtBQUssRUFBVTtRQUNqQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztRQUMzRixVQUFVLEVBQUU7WUFDVixFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtZQUNoQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFO1NBQ2xEO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBQ2pCLENBQUM7SUFDRCxNQUFNO0lBRU4sQ0FBQztJQUVELEdBQUcsRUFB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RyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3JDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQTtTQUNwRDtRQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFbEIsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLFVBQVUsRUFBRSxLQUFLO1NBQ2xCLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FHRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy91c2VyX3Rhc2tfbGlzdC91c2VyX3Rhc2tfbGlzdC50c1xudmFyIGFwaSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3JlcXVlc3QvYXBpJylcblxuaW50ZXJmYWNlIFVzZXJUYXNrSXRlbSB7XG4gIGlkOiBudW1iZXJcbiAgbmFtZTogc3RyaW5nXG4gIGRldGFpbDogc3RyaW5nXG4gIHByb2Nlc3M6IFByb2Nlc3NcbiAgc2hvd01vcmU6IGJvb2xlYW5cbn1cblxuaW50ZXJmYWNlIFByb2Nlc3Mge1xuICBpZDogbnVtYmVyXG4gIGNvbXBsZXRlZDogYm9vbGVhblxuICBkZXRhaWw6IHN0cmluZ1xuICBkZXRhaWxzOiBBcnJheTxEZXRhaWw+XG59XG5cbmludGVyZmFjZSBEZXRhaWwge1xuICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gIHRpbWU6IHN0cmluZ1xufVxuXG5jb25zdCBDT05GSVJNX1VTRVJfVEFTSyA9IDFcbmNvbnN0IENBTkNFTF9VU1JfVEFTSyA9IDJcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBhZGRmbGFnOiB0cnVlLCAgLy/liKTmlq3mmK/lkKbmmL7npLrmkJzntKLmoYblj7Pkvqfpg6jliIZcbiAgICBhZGRpbWc6ICcuLi8uLi9pbWFnZXMvYWN0aXZpdHlfYWRkLnBuZycsXG4gICAgc2VhcmNoc3RyOiAnJyxcbiAgICBsaXN0RGF0YTogbmV3IEFycmF5PFVzZXJUYXNrSXRlbT4oKSxcblxuICAgIC8v5Y+v5Lul6YCa6L+HaGlkZGVu5piv5ZCm5o6p6JeP5by55Ye65qGG55qE5bGe5oCn77yM5p2l5oyH5a6a6YKj5Liq5by55Ye65qGGXG4gICAgaGlkZGVuTW9kYWxQdXQ6IHRydWUsXG4gICAgYWN0aXZlVGFzazogPFVzZXJUYXNrSXRlbT57XG4gICAgICBpZDogMCxcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgZGV0YWlsOiAnJyxcbiAgICAgIHByb2Nlc3M6IHt9LFxuICAgICAgc2hvd01vcmU6IGZhbHNlXG4gICAgfSxcbiAgICB1cGRhdGVEZXRhaWw6ICcnLFxuICAgIGV4aXN0RGV0YWlsczogbmV3IEFycmF5PERldGFpbD4oKSxcbiAgICBidXR0b25zOiBbeyB0ZXh0OiAn5Y+W5raIJywgaW5kZXg6IENBTkNFTF9VU1JfVEFTSyB9LCB7IHRleHQ6ICfnoa7lrponLCBpbmRleDogQ09ORklSTV9VU0VSX1RBU0sgfV0sXG4gICAgcmFkaW9JdGVtczogW1xuICAgICAgeyBuYW1lOiAn5pyq5a6M5oiQJywgdmFsdWU6ICdVTkRPTkUnIH0sXG4gICAgICB7IG5hbWU6ICflrozmiJAnLCB2YWx1ZTogJ0NPTVBMRVRFRCcsIGNoZWNrZWQ6IHRydWUgfSxcbiAgICBdLFxuICB9LFxuXG4gIG9uTG9hZCgpIHtcbiAgICB0aGlzLmxvYWREYXRhKClcbiAgfSxcbiAgb25TaG93KCkge1xuXG4gIH0sXG5cbiAgdGFwKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG4gIH0sXG5cbiAgLy8g5pCc57Si5qGG5Y+z5L6nIOS6i+S7tlxuICBhZGRoYW5kbGUoKSB7XG4gICAgY29uc29sZS5sb2coJ+inpuWPkeaQnOe0ouahhuWPs+S+p+S6i+S7ticpXG4gIH0sXG5cbiAgLy/mkJzntKLmoYbovpPlhaXml7bop6blj5FcbiAgc2VhcmNoTGlzdChldjogYW55KSB7XG4gICAgbGV0IGUgPSBldi5kZXRhaWw7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHNlYXJjaHN0cjogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuICAvL+aQnOe0ouWbnuiwg1xuICBlbmRzZWFyY2hMaXN0KGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCfmn6Xor6LmlbDmja4nLCBlKVxuICB9LFxuICAvLyDlj5bmtojmkJzntKJcbiAgY2FuY2Vsc2VhcmNoKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzZWFyY2hzdHI6ICcnXG4gICAgfSlcbiAgfSxcbiAgLy/muIXnqbrmkJzntKLmoYZcbiAgYWN0aXZpdHlfY2xlYXIoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coZSlcblxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzZWFyY2hzdHI6ICcnXG4gICAgfSlcbiAgfSxcblxuICBsb2FkRGF0YSgpIHtcbiAgICBhcGkudXNlclRhc2tMaXN0KCkudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIGxldCBsaXN0OiBBcnJheTxVc2VyVGFza0l0ZW0+ID0gbmV3IEFycmF5KClcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCByZXMuZGF0YS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHJlcy5kYXRhW2luZGV4XTtcbiAgICAgICAgbGlzdC5wdXNoKHtcbiAgICAgICAgICBpZDogZWxlbWVudC5pZCxcbiAgICAgICAgICBuYW1lOiBlbGVtZW50Lm5hbWUsXG4gICAgICAgICAgZGV0YWlsOiBlbGVtZW50LmRldGFpbCxcbiAgICAgICAgICBwcm9jZXNzOiB7XG4gICAgICAgICAgICBpZDogZWxlbWVudC5wcm9jZXNzLmlkLFxuICAgICAgICAgICAgZGV0YWlsOiBlbGVtZW50LnByb2Nlc3MuZGV0YWlsLFxuICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRldGFpbHM6IGVsZW1lbnQucHJvY2Vzcy5kZXRhaWxzID8/IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2hvd01vcmU6IGZhbHNlXG4gICAgICAgIH0pXG5cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCfotYvlgLzlrozmiJDnmoQgbGlzdCDkuLo6JywgbGlzdClcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGxpc3REYXRhOiBsaXN0XG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG5cbiAgdGFwVGFza0l0ZW0oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+S6huS7u+WKoeWNoeeJhyzkuovku7bkuLo6JywgZSlcbiAgICBsZXQgbGlzdERhdGEgPSB0aGlzLmRhdGEubGlzdERhdGFcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGlzdERhdGEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gbGlzdERhdGFbaW5kZXhdO1xuICAgICAgaWYgKGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW1JZCA9PSBlbGVtZW50LmlkKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCfmjInntKLlvJXlj5blh7rnmoTmlbDmja7kuLo6JywgbGlzdERhdGFbaW5kZXhdKVxuICAgICAgICAvLyBjb25zb2xlLmxvZygn5LmL5YmN5oyJ57Si5byV5Y+W5Ye655qE5Li6OicsIGxpc3REYXRhW2luZGV4XSlcbiAgICAgICAgbGlzdERhdGFbaW5kZXhdLnNob3dNb3JlID0gIWVsZW1lbnQuc2hvd01vcmVcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGxpc3REYXRhOiBsaXN0RGF0YSxcbiAgICB9KVxuICB9LFxuXG4gIG9uUmlnaHRCdG5UYXAoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+WPs+i+ueeahOaMiemSruS6i+S7tuW5tuS4lOiiqyBjYXRjaCcsIGUpXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGFjdGl2ZVRhc2s6IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW0sXG4gICAgICBoaWRkZW5Nb2RhbFB1dDogIXRoaXMuZGF0YS5oaWRkZW5Nb2RhbFB1dCxcbiAgICAgIGV4aXN0RGV0YWlsczogZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbS5wcm9jZXNzLmRldGFpbHNcbiAgICB9KVxuICB9LFxuXG4gIC8v54K55Ye75oyJ6ZKu5by55Ye65oyH5a6a55qEaGlkZGVuTW9kYWxQdXTlvLnlh7rmoYZcbiAgLy/lvLnlh7rmoYbnmoTooajljZVcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy/lj5bmtojmjInpkq5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pO1xuICB9LFxuICAvL+ehruiupFxuICBjb25maXJtKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pXG4gIH0sXG5cbiAgdGV4dElucHV0KGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCflvZPliY3mlofmnKzovpPlhaXnmoTkuovku7bkuLo6JywgZSlcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdXBkYXRlRGV0YWlsOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG5cbiAgLy/lr7nor53moYbngrnlh7vnoa7lrprlkozlj5bmtojlnYfov5vlhaXmraTlpIQg5qC55o2uIGluZGV4IOi/m+ihjOWIpOaWrVxuICB0YXBEaWFsb2dCdXR0b24oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+S8oOWFpeeahOS6i+S7tuS4ujonLCBlKVxuICAgIC8v5aaC5p6c54K55Ye755qE5piv56Gu6K6k5oyJ6ZKuXG4gICAgaWYgKGUuZGV0YWlsLml0ZW0uaW5kZXggPT0gQ09ORklSTV9VU0VSX1RBU0spIHtcbiAgICAgIGNvbnNvbGUubG9nKCflvZPliY3pobXpnaLmlbDmja7kuLo6JywgdGhpcy5kYXRhLmFjdGl2ZVRhc2spXG4gICAgICBjb25zb2xlLmxvZygn5b2T5YmN55qEIGRldGFpbCDmlbDmja7kuLo6JywgdGhpcy5kYXRhLnVwZGF0ZURldGFpbClcbiAgICAgIGFwaS51cGRhdGVQcm9jZXNzKHtcbiAgICAgICAgcHJvY2Vzc19pZDogdGhpcy5kYXRhLmFjdGl2ZVRhc2sucHJvY2Vzcy5pZCxcbiAgICAgICAgZGV0YWlsOiB0aGlzLmRhdGEudXBkYXRlRGV0YWlsLFxuICAgICAgICBjb21wbGV0ZWQ6IDEsXG4gICAgICB9KS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygn5pu05paw55So5oi35Lu75Yqh57uG6IqC6L+U5Zue57uT5p6c5Li6OjonLCByZXMpXG4gICAgICAgIC8v5pu05paw5a6M5oiQ5LmL5ZCO6YeN5paw5ouJ5Y+W5pWw5o2uXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgaGlkZGVuTW9kYWxQdXQ6IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5sb2FkRGF0YSgpXG4gICAgICB9KS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ+abtOaWsOeUqOaIt+S7u+WKoee7huiKguWksei0pSznu5PmnpzkuLo6JywgZXJyKVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAoZS5kZXRhaWwuaXRlbS5pbmRleCA9PSBDQU5DRUxfVVNSX1RBU0spIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlXG4gICAgICB9KVxuICAgIH1cblxuICB9LFxuXG4gIHJhZGlvQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCfngrnlh7vkuobliIfmjaLmjInpkq4nKVxuICAgIHZhciBpdGVtcyA9IHRoaXMuZGF0YS5yYWRpb0l0ZW1zXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7ICsraSkge1xuICAgICAgaXRlbXNbaV0uY2hlY2tlZCA9IGl0ZW1zW2ldLnZhbHVlID09IGUuZGV0YWlsLnZhbHVlXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGl0ZW1zKVxuXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHJhZGlvSXRlbXM6IGl0ZW1zXG4gICAgfSk7XG4gIH0sXG5cblxufSkiXX0=