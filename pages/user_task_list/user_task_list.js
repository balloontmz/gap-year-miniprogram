"use strict";
var api = require('../../utils/request/api');
var CONFIRM_USER_TASK = 1;
var CANCEL_USR_TASK = 2;
Page({
    data: {
        addflag: true,
        addimg: '../../images/activity_add.png',
        searchstr: '',
        listData: new Array(),
        hiddenModalPut: true,
        activeTask: {
            id: 0,
            name: '',
            detail: '',
            process: {},
            showMore: false
        },
        updateDetail: '',
        existDetails: new Array(),
        buttons: [{ text: '取消', index: CANCEL_USR_TASK }, { text: '确定', index: CONFIRM_USER_TASK }],
        radioItems: [
            { name: '未完成', value: 'UNDONE' },
            { name: '完成', value: 'COMPLETED', checked: true },
        ],
    },
    onLoad: function () {
        this.loadData();
    },
    onShow: function () {
    },
    tap: function (e) {
        console.log(e);
    },
    addhandle: function () {
        console.log('触发搜索框右侧事件');
    },
    searchList: function (ev) {
        var e = ev.detail;
        this.setData({
            searchstr: e.detail.value
        });
    },
    endsearchList: function (e) {
        console.log('查询数据', e);
    },
    cancelsearch: function () {
        this.setData({
            searchstr: ''
        });
    },
    activity_clear: function (e) {
        console.log(e);
        this.setData({
            searchstr: ''
        });
    },
    loadData: function () {
        var _this = this;
        api.userTaskList({}).then(function (res) {
            var _a;
            console.log(res);
            var list = new Array();
            for (var index = 0; index < res.data.length; index++) {
                var element = res.data[index];
                list.push({
                    id: element.id,
                    name: element.name,
                    detail: element.detail,
                    process: {
                        id: element.process.id,
                        detail: element.process.detail,
                        completed: false,
                        details: (_a = element.process.details) !== null && _a !== void 0 ? _a : [],
                    },
                    showMore: false
                });
            }
            console.log('赋值完成的 list 为:', list);
            _this.setData({
                listData: list
            });
        });
    },
    tapTaskItem: function (e) {
        console.log('点击了任务卡片,事件为:', e);
        var listData = this.data.listData;
        for (var index = 0; index < listData.length; index++) {
            var element = listData[index];
            if (e.currentTarget.dataset.itemId == element.id) {
                listData[index].showMore = !element.showMore;
            }
        }
        this.setData({
            listData: listData,
        });
    },
    onRightBtnTap: function (e) {
        console.log('点击右边的按钮事件并且被 catch', e);
        this.setData({
            activeTask: e.currentTarget.dataset.item,
            hiddenModalPut: !this.data.hiddenModalPut,
            existDetails: e.currentTarget.dataset.item.process.details
        });
    },
    cancel: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    confirm: function () {
        this.setData({
            hiddenModalPut: true
        });
    },
    textInput: function (e) {
        console.log('当前文本输入的事件为:', e);
        this.setData({
            updateDetail: e.detail.value
        });
    },
    tapDialogButton: function (e) {
        var _this = this;
        console.log('传入的事件为:', e);
        if (e.detail.item.index == CONFIRM_USER_TASK) {
            console.log('当前页面数据为:', this.data.activeTask);
            console.log('当前的 detail 数据为:', this.data.updateDetail);
            api.updateProcess({
                process_id: this.data.activeTask.process.id,
                detail: this.data.updateDetail,
                completed: 1,
            }).then(function (res) {
                console.log('更新用户任务细节返回结果为::', res);
                _this.setData({
                    hiddenModalPut: true
                });
                _this.loadData();
            }).catch(function (err) {
                console.log('更新用户任务细节失败,结果为:', err);
                _this.setData({
                    hiddenModalPut: true
                });
            });
        }
        else if (e.detail.item.index == CANCEL_USR_TASK) {
            this.setData({
                hiddenModalPut: true
            });
        }
    },
    radioChange: function (e) {
        console.log('点击了切换按钮');
        var items = this.data.radioItems;
        for (var i = 0; i < items.length; ++i) {
            items[i].checked = items[i].value == e.detail.value;
        }
        console.log(items);
        this.setData({
            radioItems: items
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcl90YXNrX2xpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2VyX3Rhc2tfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsSUFBSSxHQUFHLEdBQXVCLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFBO0FBc0JoRSxJQUFNLGlCQUFpQixHQUFHLENBQUMsQ0FBQTtBQUMzQixJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUE7QUFFekIsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLElBQUk7UUFDYixNQUFNLEVBQUUsK0JBQStCO1FBQ3ZDLFNBQVMsRUFBRSxFQUFFO1FBQ2IsUUFBUSxFQUFFLElBQUksS0FBSyxFQUFnQjtRQUduQyxjQUFjLEVBQUUsSUFBSTtRQUNwQixVQUFVLEVBQWdCO1lBQ3hCLEVBQUUsRUFBRSxDQUFDO1lBQ0wsSUFBSSxFQUFFLEVBQUU7WUFDUixNQUFNLEVBQUUsRUFBRTtZQUNWLE9BQU8sRUFBRSxFQUFFO1lBQ1gsUUFBUSxFQUFFLEtBQUs7U0FDaEI7UUFDRCxZQUFZLEVBQUUsRUFBRTtRQUNoQixZQUFZLEVBQUUsSUFBSSxLQUFLLEVBQVU7UUFDakMsT0FBTyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFLENBQUM7UUFDM0YsVUFBVSxFQUFFO1lBQ1YsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7WUFDaEMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtTQUNsRDtLQUNGO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNqQixDQUFDO0lBQ0QsTUFBTTtJQUVOLENBQUM7SUFFRCxHQUFHLEVB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QUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDckMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFBO1NBQ3BEO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUVsQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsVUFBVSxFQUFFLEtBQUs7U0FDbEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUdGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL3VzZXJfdGFza19saXN0L3VzZXJfdGFza19saXN0LnRzXG52YXIgYXBpOiBBcGlSZXF1ZXN0LlJlcXVlc3QgPSByZXF1aXJlKCcuLi8uLi91dGlscy9yZXF1ZXN0L2FwaScpXG5cbmludGVyZmFjZSBVc2VyVGFza0l0ZW0ge1xuICBpZDogbnVtYmVyXG4gIG5hbWU6IHN0cmluZ1xuICBkZXRhaWw6IHN0cmluZ1xuICBwcm9jZXNzOiBQcm9jZXNzXG4gIHNob3dNb3JlOiBib29sZWFuXG59XG5cbmludGVyZmFjZSBQcm9jZXNzIHtcbiAgaWQ6IG51bWJlclxuICBjb21wbGV0ZWQ6IGJvb2xlYW5cbiAgZGV0YWlsOiBzdHJpbmdcbiAgZGV0YWlsczogQXJyYXk8RGV0YWlsPlxufVxuXG5pbnRlcmZhY2UgRGV0YWlsIHtcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICB0aW1lOiBzdHJpbmdcbn1cblxuY29uc3QgQ09ORklSTV9VU0VSX1RBU0sgPSAxXG5jb25zdCBDQU5DRUxfVVNSX1RBU0sgPSAyXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgYWRkZmxhZzogdHJ1ZSwgIC8v5Yik5pat5piv5ZCm5pi+56S65pCc57Si5qGG5Y+z5L6n6YOo5YiGXG4gICAgYWRkaW1nOiAnLi4vLi4vaW1hZ2VzL2FjdGl2aXR5X2FkZC5wbmcnLFxuICAgIHNlYXJjaHN0cjogJycsXG4gICAgbGlzdERhdGE6IG5ldyBBcnJheTxVc2VyVGFza0l0ZW0+KCksXG5cbiAgICAvL+WPr+S7pemAmui/h2hpZGRlbuaYr+WQpuaOqeiXj+W8ueWHuuahhueahOWxnuaAp++8jOadpeaMh+WumumCo+S4quW8ueWHuuahhlxuICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlLFxuICAgIGFjdGl2ZVRhc2s6IDxVc2VyVGFza0l0ZW0+e1xuICAgICAgaWQ6IDAsXG4gICAgICBuYW1lOiAnJyxcbiAgICAgIGRldGFpbDogJycsXG4gICAgICBwcm9jZXNzOiB7fSxcbiAgICAgIHNob3dNb3JlOiBmYWxzZVxuICAgIH0sXG4gICAgdXBkYXRlRGV0YWlsOiAnJyxcbiAgICBleGlzdERldGFpbHM6IG5ldyBBcnJheTxEZXRhaWw+KCksXG4gICAgYnV0dG9uczogW3sgdGV4dDogJ+WPlua2iCcsIGluZGV4OiBDQU5DRUxfVVNSX1RBU0sgfSwgeyB0ZXh0OiAn56Gu5a6aJywgaW5kZXg6IENPTkZJUk1fVVNFUl9UQVNLIH1dLFxuICAgIHJhZGlvSXRlbXM6IFtcbiAgICAgIHsgbmFtZTogJ+acquWujOaIkCcsIHZhbHVlOiAnVU5ET05FJyB9LFxuICAgICAgeyBuYW1lOiAn5a6M5oiQJywgdmFsdWU6ICdDT01QTEVURUQnLCBjaGVja2VkOiB0cnVlIH0sXG4gICAgXSxcbiAgfSxcblxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5sb2FkRGF0YSgpXG4gIH0sXG4gIG9uU2hvdygpIHtcblxuICB9LFxuXG4gIHRhcChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlKVxuICB9LFxuXG4gIC8vIOaQnOe0ouahhuWPs+S+pyDkuovku7ZcbiAgYWRkaGFuZGxlKCkge1xuICAgIGNvbnNvbGUubG9nKCfop6blj5HmkJzntKLmoYblj7Pkvqfkuovku7YnKVxuICB9LFxuXG4gIC8v5pCc57Si5qGG6L6T5YWl5pe26Kem5Y+RXG4gIHNlYXJjaExpc3QoZXY6IGFueSkge1xuICAgIGxldCBlID0gZXYuZGV0YWlsO1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzZWFyY2hzdHI6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcbiAgLy/mkJzntKLlm57osINcbiAgZW5kc2VhcmNoTGlzdChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygn5p+l6K+i5pWw5o2uJywgZSlcbiAgfSxcbiAgLy8g5Y+W5raI5pCc57SiXG4gIGNhbmNlbHNlYXJjaCgpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgc2VhcmNoc3RyOiAnJ1xuICAgIH0pXG4gIH0sXG4gIC8v5riF56m65pCc57Si5qGGXG4gIGFjdGl2aXR5X2NsZWFyKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG5cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgc2VhcmNoc3RyOiAnJ1xuICAgIH0pXG4gIH0sXG5cbiAgbG9hZERhdGEoKSB7XG4gICAgYXBpLnVzZXJUYXNrTGlzdCh7fSkudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIGxldCBsaXN0OiBBcnJheTxVc2VyVGFza0l0ZW0+ID0gbmV3IEFycmF5KClcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCByZXMuZGF0YS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHJlcy5kYXRhW2luZGV4XTtcbiAgICAgICAgbGlzdC5wdXNoKHtcbiAgICAgICAgICBpZDogZWxlbWVudC5pZCxcbiAgICAgICAgICBuYW1lOiBlbGVtZW50Lm5hbWUsXG4gICAgICAgICAgZGV0YWlsOiBlbGVtZW50LmRldGFpbCxcbiAgICAgICAgICBwcm9jZXNzOiB7XG4gICAgICAgICAgICBpZDogZWxlbWVudC5wcm9jZXNzLmlkLFxuICAgICAgICAgICAgZGV0YWlsOiBlbGVtZW50LnByb2Nlc3MuZGV0YWlsLFxuICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRldGFpbHM6IGVsZW1lbnQucHJvY2Vzcy5kZXRhaWxzID8/IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2hvd01vcmU6IGZhbHNlXG4gICAgICAgIH0pXG5cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCfotYvlgLzlrozmiJDnmoQgbGlzdCDkuLo6JywgbGlzdClcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGxpc3REYXRhOiBsaXN0XG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG5cbiAgdGFwVGFza0l0ZW0oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+S6huS7u+WKoeWNoeeJhyzkuovku7bkuLo6JywgZSlcbiAgICBsZXQgbGlzdERhdGEgPSB0aGlzLmRhdGEubGlzdERhdGFcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGlzdERhdGEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gbGlzdERhdGFbaW5kZXhdO1xuICAgICAgaWYgKGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW1JZCA9PSBlbGVtZW50LmlkKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCfmjInntKLlvJXlj5blh7rnmoTmlbDmja7kuLo6JywgbGlzdERhdGFbaW5kZXhdKVxuICAgICAgICAvLyBjb25zb2xlLmxvZygn5LmL5YmN5oyJ57Si5byV5Y+W5Ye655qE5Li6OicsIGxpc3REYXRhW2luZGV4XSlcbiAgICAgICAgbGlzdERhdGFbaW5kZXhdLnNob3dNb3JlID0gIWVsZW1lbnQuc2hvd01vcmVcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGxpc3REYXRhOiBsaXN0RGF0YSxcbiAgICB9KVxuICB9LFxuXG4gIG9uUmlnaHRCdG5UYXAoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+eCueWHu+WPs+i+ueeahOaMiemSruS6i+S7tuW5tuS4lOiiqyBjYXRjaCcsIGUpXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGFjdGl2ZVRhc2s6IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW0sXG4gICAgICBoaWRkZW5Nb2RhbFB1dDogIXRoaXMuZGF0YS5oaWRkZW5Nb2RhbFB1dCxcbiAgICAgIGV4aXN0RGV0YWlsczogZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbS5wcm9jZXNzLmRldGFpbHNcbiAgICB9KVxuICB9LFxuXG4gIC8v54K55Ye75oyJ6ZKu5by55Ye65oyH5a6a55qEaGlkZGVuTW9kYWxQdXTlvLnlh7rmoYZcbiAgLy/lvLnlh7rmoYbnmoTooajljZVcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy/lj5bmtojmjInpkq5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pO1xuICB9LFxuICAvL+ehruiupFxuICBjb25maXJtKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoaWRkZW5Nb2RhbFB1dDogdHJ1ZVxuICAgIH0pXG4gIH0sXG5cbiAgdGV4dElucHV0KGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCflvZPliY3mlofmnKzovpPlhaXnmoTkuovku7bkuLo6JywgZSlcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdXBkYXRlRGV0YWlsOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG5cbiAgLy/lr7nor53moYbngrnlh7vnoa7lrprlkozlj5bmtojlnYfov5vlhaXmraTlpIQg5qC55o2uIGluZGV4IOi/m+ihjOWIpOaWrVxuICB0YXBEaWFsb2dCdXR0b24oZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+S8oOWFpeeahOS6i+S7tuS4ujonLCBlKVxuICAgIC8v5aaC5p6c54K55Ye755qE5piv56Gu6K6k5oyJ6ZKuXG4gICAgaWYgKGUuZGV0YWlsLml0ZW0uaW5kZXggPT0gQ09ORklSTV9VU0VSX1RBU0spIHtcbiAgICAgIGNvbnNvbGUubG9nKCflvZPliY3pobXpnaLmlbDmja7kuLo6JywgdGhpcy5kYXRhLmFjdGl2ZVRhc2spXG4gICAgICBjb25zb2xlLmxvZygn5b2T5YmN55qEIGRldGFpbCDmlbDmja7kuLo6JywgdGhpcy5kYXRhLnVwZGF0ZURldGFpbClcbiAgICAgIGFwaS51cGRhdGVQcm9jZXNzKHtcbiAgICAgICAgcHJvY2Vzc19pZDogdGhpcy5kYXRhLmFjdGl2ZVRhc2sucHJvY2Vzcy5pZCxcbiAgICAgICAgZGV0YWlsOiB0aGlzLmRhdGEudXBkYXRlRGV0YWlsLFxuICAgICAgICBjb21wbGV0ZWQ6IDEsXG4gICAgICB9KS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygn5pu05paw55So5oi35Lu75Yqh57uG6IqC6L+U5Zue57uT5p6c5Li6OjonLCByZXMpXG4gICAgICAgIC8v5pu05paw5a6M5oiQ5LmL5ZCO6YeN5paw5ouJ5Y+W5pWw5o2uXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgaGlkZGVuTW9kYWxQdXQ6IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5sb2FkRGF0YSgpXG4gICAgICB9KS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ+abtOaWsOeUqOaIt+S7u+WKoee7huiKguWksei0pSznu5PmnpzkuLo6JywgZXJyKVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAoZS5kZXRhaWwuaXRlbS5pbmRleCA9PSBDQU5DRUxfVVNSX1RBU0spIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGhpZGRlbk1vZGFsUHV0OiB0cnVlXG4gICAgICB9KVxuICAgIH1cblxuICB9LFxuXG4gIHJhZGlvQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCfngrnlh7vkuobliIfmjaLmjInpkq4nKVxuICAgIHZhciBpdGVtcyA9IHRoaXMuZGF0YS5yYWRpb0l0ZW1zXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7ICsraSkge1xuICAgICAgaXRlbXNbaV0uY2hlY2tlZCA9IGl0ZW1zW2ldLnZhbHVlID09IGUuZGV0YWlsLnZhbHVlXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGl0ZW1zKVxuXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHJhZGlvSXRlbXM6IGl0ZW1zXG4gICAgfSk7XG4gIH0sXG5cblxufSkiXX0=